package com.example.widgetdemo;

import android.app.PendingIntent;
import android.appwidget.AppWidgetManager;
import android.appwidget.AppWidgetProvider;
import android.content.ActivityNotFoundException;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.widget.RemoteViews;
import android.widget.Toast;

public class MyWidgetProvider extends AppWidgetProvider {

	@Override
	public void onUpdate(Context context, AppWidgetManager appWidgetManager,
			int[] appWidgetIds) {

		for (int j = 0; j < appWidgetIds.length; j++) {
			int appWidgetId = appWidgetIds[j];

			try {
				Intent intent = new Intent("android.intent.action.MAIN");
				intent.addCategory("android.intent.category.LAUNCHER");

				intent.addFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION);
				intent.setComponent(new ComponentName(
						"com.zaptech.wallpapermanager",
						"com.zaptech.wallpapermanager.Splash"));
				PendingIntent pendingIntent = PendingIntent.getActivity(
						context, 0, intent, 0);
				RemoteViews remoteViews = new RemoteViews(
						context.getPackageName(), R.layout.activity_home);
				remoteViews.setOnClickPendingIntent(R.id.widget_button,
						buildButtonPendingIntent(context));
				pushWidgetUpdate(context, remoteViews);
			} catch (ActivityNotFoundException e) {
				Toast.makeText(context.getApplicationContext(),
						"There was a problem loading the application: ",
						Toast.LENGTH_SHORT).show();
			}

		}

	}

	public static PendingIntent buildButtonPendingIntent(Context context) {
		Intent intent = new Intent();
		intent.setAction("pl.looksok.intent.action.CHANGE_PICTURE");
		return PendingIntent.getBroadcast(context, 0, intent,
				PendingIntent.FLAG_UPDATE_CURRENT);
	}

	static void pushWidgetUpdate(Context context, RemoteViews remoteViews) {

		ComponentName myWidget = new ComponentName(context,
				MyWidgetProvider.class);
		AppWidgetManager manager = AppWidgetManager.getInstance(context);
		manager.updateAppWidget(myWidget, remoteViews);
	}

}
